---
title: Basic Usage
description: A practical walkthrough of building a Flutter feature with Qora — from setup to a complete list and detail screen.
---

This guide builds a complete user management feature from scratch: listing users, viewing a detail page, and triggering manual refreshes. You will see how caching, background revalidation, and invalidation compose naturally.

---

## Prerequisites

Install and configure `flutter_qora` as described in the [Setup guide](../flutter-integration/setup.md). The code below assumes:

```dart [main.dart]
import 'package:flutter/material.dart';
import 'package:flutter_qora/flutter_qora.dart';

void main() {
  final client = QoraClient(
    config: const QoraClientConfig(
      defaultOptions: QoraOptions(
        staleTime: Duration(minutes: 5),
        retryCount: 3,
      ),
      debugMode: true,
    ),
  );

  runApp(
    QoraScope(
      client: client,
      lifecycleManager: FlutterLifecycleManager(qoraClient: client),
      child: const MyApp(),
    ),
  );
}
```

---

## Step 1: Define Your Models

```dart [models/user.dart]
class User {
  final int id;
  final String name;
  final String email;

  const User({required this.id, required this.name, required this.email});

  User copyWith({String? name, String? email}) => User(
        id: id,
        name: name ?? this.name,
        email: email ?? this.email,
      );

  factory User.fromJson(Map<String, dynamic> json) => User(
        id: json['id'] as int,
        name: json['name'] as String,
        email: json['email'] as String,
      );
}
```

---

## Step 2: Define Your API Service

```dart [services/user_api.dart]
class UserApi {
  static Future<List<User>> getUsers() async {
    final response = await http.get(Uri.parse('https://api.example.com/users'));
    if (response.statusCode != 200) {
      throw HttpException('Failed to load users: ${response.statusCode}');
    }
    final list = jsonDecode(response.body) as List<dynamic>;
    return list.map((j) => User.fromJson(j as Map<String, dynamic>)).toList();
  }

  static Future<User> getUser(int id) async {
    final response = await http.get(Uri.parse('https://api.example.com/users/$id'));
    if (response.statusCode != 200) {
      throw HttpException('Failed to load user: ${response.statusCode}');
    }
    return User.fromJson(jsonDecode(response.body) as Map<String, dynamic>);
  }
}
```

:::warning
Always **throw** on HTTP errors — never return `null`. Qora needs the exception to transition the query to `Failure` state and trigger automatic retries.
:::

---

## Step 3: Build the List Screen

```dart [screens/user_list_screen.dart]
class UserListScreen extends StatelessWidget {
  const UserListScreen({super.key});

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text('Users'),
        actions: [
          IconButton(
            icon: const Icon(Icons.refresh),
            // Force a refetch — even if data is still fresh
            onPressed: () => context.qora.invalidate(['users']),
          ),
        ],
      ),
      body: QoraBuilder<List<User>>(
        queryKey: const ['users'],
        queryFn: UserApi.getUsers,
        builder: (context, state) {
          return state.when(
            onInitial: () => const SizedBox.shrink(),
            onLoading: (previousData) {
              if (previousData != null) {
                return Stack(
                  children: [
                    _UserList(users: previousData),
                    const LinearProgressIndicator(),
                  ],
                );
              }
              return const Center(child: CircularProgressIndicator());
            },
            onSuccess: (users, _) => _UserList(users: users),
            onError: (error, _, previousData) => Center(
              child: Column(
                mainAxisAlignment: MainAxisAlignment.center,
                children: [
                  if (previousData != null)
                    Expanded(child: _UserList(users: previousData)),
                  Text('Error: $error'),
                  ElevatedButton(
                    onPressed: () => context.qora.invalidate(['users']),
                    child: const Text('Retry'),
                  ),
                ],
              ),
            ),
          );
        },
      ),
    );
  }
}

class _UserList extends StatelessWidget {
  final List<User> users;

  const _UserList({required this.users});

  @override
  Widget build(BuildContext context) {
    return ListView.builder(
      itemCount: users.length,
      itemBuilder: (context, i) {
        final user = users[i];
        return ListTile(
          leading: CircleAvatar(child: Text(user.name[0])),
          title: Text(user.name),
          subtitle: Text(user.email),
          onTap: () => Navigator.push(
            context,
            MaterialPageRoute(
              builder: (_) => UserDetailScreen(userId: user.id),
            ),
          ),
        );
      },
    );
  }
}
```

The first time `UserListScreen` mounts, the state transitions `Initial → Loading → Success`. On every subsequent visit, the cache serves data immediately and Qora revalidates in the background only if `staleTime` has elapsed.

---

## Step 4: Build the Detail Screen

```dart [screens/user_detail_screen.dart]
class UserDetailScreen extends StatelessWidget {
  final int userId;

  const UserDetailScreen({super.key, required this.userId});

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text('User #$userId'),
        actions: [
          IconButton(
            icon: const Icon(Icons.refresh),
            onPressed: () => context.qora.invalidate(['users', userId]),
          ),
        ],
      ),
      body: QoraBuilder<User>(
        queryKey: ['users', userId],
        queryFn: () => UserApi.getUser(userId),
        builder: (context, state) {
          return state.when(
            onInitial: () => const SizedBox.shrink(),
            onLoading: (previousData) => previousData != null
                ? _UserDetail(user: previousData, isRefreshing: true)
                : const Center(child: CircularProgressIndicator()),
            onSuccess: (user, updatedAt) => _UserDetail(user: user),
            onError: (error, _, previousData) => Center(
              child: Column(
                mainAxisAlignment: MainAxisAlignment.center,
                children: [
                  Text('Error: $error'),
                  ElevatedButton(
                    onPressed: () =>
                        context.qora.invalidate(['users', userId]),
                    child: const Text('Retry'),
                  ),
                ],
              ),
            ),
          );
        },
      ),
    );
  }
}

class _UserDetail extends StatelessWidget {
  final User user;
  final bool isRefreshing;

  const _UserDetail({required this.user, this.isRefreshing = false});

  @override
  Widget build(BuildContext context) {
    return Column(
      children: [
        if (isRefreshing) const LinearProgressIndicator(),
        Padding(
          padding: const EdgeInsets.all(24),
          child: Column(
            children: [
              CircleAvatar(
                radius: 48,
                child: Text(user.name[0], style: const TextStyle(fontSize: 40)),
              ),
              const SizedBox(height: 24),
              Text(user.name, style: Theme.of(context).textTheme.headlineMedium),
              const SizedBox(height: 8),
              Text(user.email, style: Theme.of(context).textTheme.bodyLarge),
            ],
          ),
        ),
      ],
    );
  }
}
```

---

## What You Get for Free

| Feature                    | How it works                                                                              |
| -------------------------- | ----------------------------------------------------------------------------------------- |
| **Deduplication**          | Multiple widgets with the same key share a single in-flight network request               |
| **Stale-while-revalidate** | Cached data is shown instantly; a background refetch happens silently after `staleTime`   |
| **Automatic retry**        | Failed requests retry automatically with exponential backoff                              |
| **Refetch on resume**      | `FlutterLifecycleManager` invalidates queries when the app returns from the background    |
| **Reactive invalidation**  | Tapping the refresh button invalidates the key; all subscribed widgets update immediately |

---

## Next Steps

- [Optimistic Updates](./optimistic-updates.md) — Instant UI with safe rollback
- [QoraBuilder](../flutter-integration/qora-builder.md) — Full widget API reference
- [QoraOptions](../api-reference/qora-options.md) — Stale time, cache time, retry, polling
