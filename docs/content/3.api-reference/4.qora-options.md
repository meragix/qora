---
title: QoraOptions
description: Per-query configuration that overrides QoraClientConfig defaults. Pass to fetchQuery or watchQuery to customise caching, retries, staleness, and polling.
---

## Overview

`QoraOptions` configures the behaviour of an individual query. Any field left at its default inherits from `QoraClientConfig.defaultOptions`. Fields are merged with per-query values taking priority.

```dart [user_repository.dart]
await client.fetchQuery<User>(
  key: ['users', userId],
  fetcher: () => api.getUser(userId),
  options: QoraOptions(
    staleTime: Duration(minutes: 5),
    retryCount: 2,
  ),
);
```

---

## Constructor

```dart
const QoraOptions({
  Duration staleTime = Duration.zero,
  Duration cacheTime = const Duration(minutes: 5),
  bool enabled = true,
  int retryCount = 3,
  Duration retryDelay = const Duration(seconds: 1),
  Duration Function(int attemptIndex)? retryDelayCalculator,
  bool refetchOnWindowFocus = true,
  bool refetchOnReconnect = true,
  Duration? refetchInterval,
  bool? refetchOnMount,
})
```

---

## Fields

### `staleTime`

```dart
final Duration staleTime
```

**Default:** `Duration.zero`

How long data is considered **fresh** after a successful fetch. During the freshness window, `fetchQuery` and `watchQuery` skip the network entirely and return cached data.

Once `staleTime` elapses the data is considered **stale** — Qora returns it immediately but also triggers a background revalidation.

```dart [main.dart]
// Always stale (default) — serve cache, always revalidate
staleTime: Duration.zero,

// Fresh for 5 minutes — no network in the window
staleTime: Duration(minutes: 5),

// Effectively never stale
staleTime: Duration(days: 365),
```

| Data type              | Recommended value          |
| ---------------------- | -------------------------- |
| Live prices, feeds     | `Duration.zero`            |
| User profile           | `Duration(minutes: 5)`     |
| Article / post content | `Duration(minutes: 10)`    |
| App configuration      | `Duration(hours: 1)`       |
| Static reference data  | `Duration(days: 1)`        |

---

### `cacheTime`

```dart
final Duration cacheTime
```

**Default:** `Duration(minutes: 5)`

How long an **inactive** entry stays in cache after all `watchQuery` subscribers cancel. When the GC timer fires the entry is removed; the next access starts from `Initial`.

```dart [main.dart]
// Keep in cache for 10 minutes after leaving the screen
cacheTime: Duration(minutes: 10),

// Remove immediately on unsubscribe (e.g. sensitive session data)
cacheTime: Duration.zero,
```

:::tip
`staleTime` and `cacheTime` are independent. A common pattern is `staleTime < cacheTime` — data goes stale (triggering a revalidation) but stays in cache so navigation back is instant.
:::

---

### `enabled`

```dart
final bool enabled
```

**Default:** `true`

When `false`:

- `fetchQuery` throws a `StateError` immediately
- `watchQuery` emits the current state without triggering any fetch

Useful for **dependent queries** that should only run when a prerequisite is satisfied:

```dart [main.dart]
// Only fetch when userId is non-null
options: QoraOptions(enabled: userId != null),
```

---

### `retryCount`

```dart
final int retryCount
```

**Default:** `3`

Number of automatic retry attempts after a fetch failure. Set to `0` to disable retries.

```dart [main.dart]
retryCount: 0,  // fail immediately on first error
retryCount: 5,  // retry up to 5 times
```

---

### `retryDelay`

```dart
final Duration retryDelay
```

**Default:** `Duration(seconds: 1)`

Base delay between retry attempts. By default Qora uses **exponential backoff**:

- Attempt 0 → `1 s`
- Attempt 1 → `2 s`
- Attempt 2 → `4 s`
- Attempt 3 → `8 s`

---

### `retryDelayCalculator`

```dart
final Duration Function(int attemptIndex)? retryDelayCalculator
```

**Default:** `null` (uses exponential backoff)

Custom delay calculator. Receives the zero-based attempt index and returns the delay before that attempt.

```dart [main.dart]
// Fixed 500 ms delay
retryDelayCalculator: (_) => const Duration(milliseconds: 500),

// Jittered exponential backoff
retryDelayCalculator: (i) => Duration(
  milliseconds: (500 * pow(2, i) + Random().nextInt(200)).toInt(),
),
```

---

### `refetchOnWindowFocus`

```dart
final bool refetchOnWindowFocus
```

**Default:** `true`

Whether to refetch this query when the app regains window focus. Requires a `LifecycleManager` to be registered on the client.

---

### `refetchOnReconnect`

```dart
final bool refetchOnReconnect
```

**Default:** `true`

Whether to refetch this query when the network connection is restored. Requires a `ConnectivityManager` to be registered on the client.

---

### `refetchInterval`

```dart
final Duration? refetchInterval
```

**Default:** `null` (disabled)

When set, `watchQuery` automatically refetches at this cadence while at least one subscriber is active. The timer stops when the last subscriber cancels.

```dart [dashboard_page.dart]
// Poll every 30 seconds while the widget is mounted
options: QoraOptions(refetchInterval: Duration(seconds: 30)),
```

---

### `refetchOnMount`

```dart
final bool? refetchOnMount
```

**Default:** `null` (falls back to `QoraClientConfig.refetchOnMount`)

Controls whether `watchQuery` triggers a fetch on the first subscription:

| Value   | Behaviour                                                   |
| ------- | ----------------------------------------------------------- |
| `true`  | Always refetch on mount, even if data is fresh              |
| `false` | Only fetch if data is missing; skip if cached               |
| `null`  | Use `QoraClientConfig.refetchOnMount` (default: `true`)     |

---

## `getRetryDelay(int attemptIndex)`

```dart
Duration getRetryDelay(int attemptIndex)
```

Computes the retry delay for the given zero-based attempt index. Delegates to `retryDelayCalculator` if set, otherwise applies exponential backoff: `retryDelay × 2^attemptIndex`.

---

## `merge(QoraOptions? other)`

```dart
QoraOptions merge(QoraOptions? other)
```

Returns a new `QoraOptions` merging `this` with `other`. Fields from `other` take priority. Nullable fields (`retryDelayCalculator`, `refetchInterval`, `refetchOnMount`) fall back to `this` when not set in `other`.

Used internally by `QoraClient` to combine global defaults with per-query options.

---

## Common Recipes

```dart [main.dart]
// Live data — always fresh, poll every 10 s
QoraOptions(
  staleTime: Duration.zero,
  refetchInterval: Duration(seconds: 10),
)

// Config data — cache aggressively
QoraOptions(
  staleTime: Duration(hours: 1),
  cacheTime: Duration(hours: 2),
  retryCount: 5,
)

// Conditional query
QoraOptions(enabled: currentUser != null)

// Disable retries for mutations
QoraOptions(retryCount: 0)
```
