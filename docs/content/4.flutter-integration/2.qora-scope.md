---
title: QoraScope
description: The InheritedWidget that provides a QoraClient to your widget tree and manages the lifecycle of optional platform managers.
---

`QoraScope` is the single point of truth for your `QoraClient` in Flutter. Wrap your app (or a sub-tree) with it once, and every descendant gains access to the same cache and request pipeline.

---

## Anatomy

```dart [main.dart]
QoraScope(
  // Required — the shared cache and request engine
  client: client,

  // Optional — invalidates queries on app resume
  lifecycleManager: FlutterLifecycleManager(qoraClient: client),

  // Optional — invalidates queries on network reconnect
  connectivityManager: FlutterConnectivityManager(qoraClient: client),

  child: const MyApp(),
)
```

`QoraScope` is a `StatefulWidget`. It calls `start()` on each manager in `initState` and calls `dispose()` on both managers **and** on the client itself in `dispose`. You never manage their lifetime manually.

---

## Accessing the Client

### `context.qora` (recommended)

The shortest path to the client from any widget:

```dart [user_list_screen.dart]
// Invalidate a specific query after a mutation
context.qora.invalidate(['posts', postId]);

// Invalidate by predicate
context.qora.invalidateWhere((key) => key.firstOrNull == 'posts');

// Optimistic update
final snapshot = context.qora.getQueryData<User>(['users', userId]);
context.qora.setQueryData(['users', userId], updatedUser);
```

### `QoraScope.of(context)`

Equivalent to `context.qora`. Throws a descriptive `FlutterError` if no `QoraScope` ancestor is found in the tree:

```dart [user_repository.dart]
final client = QoraScope.of(context);
await client.fetchQuery<List<Post>>(
  key: ['posts'],
  fetcher: api.getPosts,
);
```

### `QoraScope.maybeOf(context)`

Returns `null` instead of throwing when `QoraScope` is absent. Useful when the scope is optional in part of the tree:

```dart [optional_widget.dart]
final client = QoraScope.maybeOf(context);
if (client == null) return const SizedBox.shrink();
```

### `context.qoraOrNull`

Shorthand for `QoraScope.maybeOf(context)`:

```dart [nav_bar.dart]
context.qoraOrNull?.invalidate(['notifications']);
```

---

## Nested Scopes

You can nest multiple `QoraScope` widgets to isolate caches for different parts of the app — for example, separate caches for public and authenticated routes:

```dart [app.dart]
QoraScope(
  client: publicClient,
  child: Navigator(
    pages: [
      MaterialPage(child: const HomeScreen()),
      MaterialPage(
        child: QoraScope(
          // Separate cache for authenticated routes
          client: authClient,
          child: const DashboardScreen(),
        ),
      ),
    ],
  ),
)
```

Each `QoraScope` manages its own client — queries are fully independent between scopes.

---

## Lifecycle and Connectivity Managers

### `FlutterLifecycleManager`

Observes `AppLifecycleState` changes via `WidgetsBindingObserver`. When the app resumes after a pause longer than `refetchInterval`, it calls `client.invalidateWhere((_) => true)`:

```dart [main.dart]
FlutterLifecycleManager(
  qoraClient: client,
  refetchInterval: const Duration(minutes: 1), // default: 5 s
)
```

Active `QoraBuilder` widgets receive the resulting `Loading(previousData: data)` state and immediately dispatch re-fetch requests. Users see the stale data instantly while fresh data loads in the background.

### `FlutterConnectivityManager`

Monitors network connectivity. When the device reconnects, it invalidates all queries to flush potentially stale data:

```dart [main.dart]
FlutterConnectivityManager(qoraClient: client)
```

:::tip
Both managers invalidate via `client.invalidateWhere((_) => true)`. Implement a custom `LifecycleManager` or `ConnectivityManager` subclass if you need more granular invalidation rules — for example, skipping user-specific queries or applying different stale windows per data type.
:::

---

## API Reference

| Property / Method              | Type                   | Description                                              |
| ------------------------------ | ---------------------- | -------------------------------------------------------- |
| `client`                       | `QoraClient`           | **Required.** The shared client for this scope.          |
| `lifecycleManager`             | `LifecycleManager?`    | Optional. Refetch on app resume.                         |
| `connectivityManager`          | `ConnectivityManager?` | Optional. Refetch on reconnect.                          |
| `child`                        | `Widget`               | **Required.** The widget subtree.                        |
| `QoraScope.of(context)`        | `QoraClient`           | Returns the client; throws if none found.                |
| `QoraScope.maybeOf(context)`   | `QoraClient?`          | Returns the client, or `null` if none found.             |
| `context.qora`                 | `QoraClient`           | Shorthand for `QoraScope.of(context)`.                   |
| `context.qoraOrNull`           | `QoraClient?`          | Shorthand for `QoraScope.maybeOf(context)`.              |

---

## Next Steps

- [QoraBuilder](./qora-builder.md) — Fetch data and bind state to Flutter widgets
- [Basic Usage Guide](../guides/basic-usage.md) — End-to-end Flutter integration walkthrough
